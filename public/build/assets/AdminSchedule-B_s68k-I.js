import{a as r,o as n,f as i,g as b,i as S,z as B,r as y,e as U,w as Z,c as q,u as G,Z as J,b as e,n as p,t as g,F as M,l as j,h as Q,d as V,C as X,m as I,v as ee,D}from"./app-B0hmWrIt.js";import{_ as $}from"./Card-DGziJDZR.js";import{_ as te}from"./AuthenticatedLayout-DVBZZxv2.js";import{_ as se}from"./NavLink-TT7O-nR-.js";import{_ as v}from"./FlexButton-DOwAwIBM.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"space-x-8 rtl:space-x-reverse sm:flex"},ne={__name:"ScheduleTabs",setup(N){return(f,Y)=>(n(),r("div",le,[i(se,{href:f.route("schedule.admin"),active:f.route().current("schedule.admin")},{default:b(()=>Y[0]||(Y[0]=[S(" Schedule ")])),_:1,__:[0]},8,["href","active"])]))}},oe={class:"py-6"},re={class:"max-w-5xl mx-auto sm:px-4 lg:px-6"},ie={class:"flex justify-between items-center mb-4"},de={class:"font-semibold text-base text-gray-200"},ue={class:"px-2 pb-4"},ce={class:"w-full border-separate border-spacing-y-1"},fe={class:"py-2 px-1 align-top"},me={class:"w-full min-h-[48px] flex items-center justify-center rounded transition text-sm font-medium border bg-gray-900 text-gray-100 border-gray-700",style:{height:"48px",width:"120px",padding:"0 0.25rem"}},xe={class:"text-xs text-center",style:{width:"100%"}},ye=["onClick","title"],pe={key:0,class:"flex items-center justify-center gap-1 w-full",style:{width:"120px"}},ge={class:"text-gray-100 font-semibold text-xs text-center",style:{"word-break":"break-word","max-height":"3.6em","line-height":"1.2",overflow:"hidden","white-space":"normal",width:"90px",display:"inline-block"}},ve={key:1,class:"flex flex-col items-center justify-center w-full",style:{width:"120px"}},be={class:"flex justify-end mt-6 space-x-2"},he={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},we={class:"bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md relative animate-fadeIn border border-gray-700"},_e=["disabled"],ke={class:"text-2xl font-bold mb-6 text-gray-100 text-center"},Ye={class:"text-base font-medium text-gray-400"},Me={key:0,class:"flex flex-col items-center justify-center py-8"},De={key:1,class:"mb-6"},Se=["disabled"],Ce=["value"],Ae={__name:"AdminSchedule",props:{staffList:{type:Array,default:()=>[]},leaveList:{type:Array,default:()=>[]}},setup(N){const f=N;console.log("staffList:",f.staffList);const Y=["Morning","Night"],T=["morning","evening"],z=B().startOf("week").add(1,"day"),o=y(z),h=y(null),w=y(null),d=y(!1),c=y({}),_=y(""),m=y(!1);async function x(){const a=o.value.format("YYYY-MM-DD"),{data:t}=await D.get("/schedule/week",{params:{week_start:a}});c.value=t.assignments||{},m.value=t.submitted||!1}U(x),Z(o,x);const W=q(()=>Array.from({length:7},(a,t)=>o.value.add(t,"day")));function F(a,t){h.value=a,w.value=t,c.value[a.format("YYYY-MM-DD")]||(c.value[a.format("YYYY-MM-DD")]=[null,null]),_.value=c.value[a.format("YYYY-MM-DD")][t]||""}function C(){d.value||(h.value=null,w.value=null)}async function P(){d.value=!0;const a=_.value,t=h.value.format("YYYY-MM-DD"),s=o.value.format("YYYY-MM-DD");if(f.leaveList&&f.leaveList.some(u=>u.user_id==a&&u.start_date<=t&&(!u.end_date||u.end_date>=t))){d.value=!1,alert("This staff is on leave for the selected day. Please pick another staff.");return}if((c.value[t]||[null,null]).includes(a)){d.value=!1,alert("This staff is already assigned to another shift on this day. Please pick another staff.");return}let l=0;for(const[u,R]of Object.entries(c.value))u>=s&&u<=B(s).add(6,"day").format("YYYY-MM-DD")&&R.includes(a)&&l++;if(l>=6){d.value=!1,alert("This staff is already assigned to 6 days in this week. Please pick another staff.");return}await D.post("/schedule/assign",{employee_id:a,shift_type:T[w.value],day:t}),await x(),d.value=!1,C()}function H(){o.value=o.value.subtract(1,"week"),x()}function O(){o.value=o.value.add(1,"week"),x()}async function E(){await D.post("/schedule/submit-week",{week_start:o.value.format("YYYY-MM-DD")}),await x(),alert("Weekly schedule submitted successfully!")}function L(a,t){var l;const s=(l=c.value[a.format("YYYY-MM-DD")])==null?void 0:l[t],k=f.staffList.find(u=>u.id==s);return k?k.name:""}function A(a,t){var s;return!!((s=c.value[a.format("YYYY-MM-DD")])!=null&&s[t])}async function K(){confirm("Are you sure you want to reset all assignments for this week?")&&(await D.post("/schedule/reset",{week_start:o.value.format("YYYY-MM-DD")}),c.value={},await x())}return(a,t)=>(n(),r(M,null,[i(G(J),{title:"Weekly Schedule"}),i(te,null,{tabs:b(()=>[i(ne)]),default:b(()=>[e("div",oe,[e("div",re,[i($,{class:"!mt-0 bg-gray-800 rounded-xl shadow-lg border border-gray-700"},{default:b(()=>[e("div",ie,[i(v,{text:"Previous",onClick:H,class:p("text-white px-4 py-1 rounded font-semibold text-sm")}),e("span",de,g(o.value.format("MMM D, YYYY"))+" - "+g(o.value.add(6,"day").format("MMM D, YYYY")),1),i(v,{text:"Next",onClick:O,class:p("text-white px-4 py-1 rounded font-semibold text-sm")})])]),_:1}),i($,{class:"mt-6 bg-gray-800 rounded-xl shadow-lg border border-gray-700"},{default:b(()=>[e("div",ue,[e("table",ce,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",{class:"text-sm font-bold text-gray-200 py-2 px-12 text-left"},"Day"),e("th",{class:"text-sm font-bold text-gray-200 py-2 text-center"},[S("Morning"),e("br"),e("span",{class:"text-xs text-gray-400"},"6:00 - 15:00")]),e("th",{class:"text-sm font-bold text-gray-200 py-2 text-center"},[S("Night"),e("br"),e("span",{class:"text-xs text-gray-400"},"15:00 - 00:00")])])],-1)),e("tbody",null,[(n(!0),r(M,null,j(W.value,(s,k)=>(n(),r("tr",{key:k,class:"border-b last:border-b-0 bg-gray-800"},[e("td",fe,[e("div",me,[e("span",xe,g(s.format("ddd D")),1)])]),(n(),r(M,null,j([0,1],l=>e("td",{key:l,class:"py-2 px-1 align-top"},[e("div",{class:p(["w-full min-h-[48px] flex items-center justify-center rounded transition text-sm font-medium border cursor-pointer relative",A(s,l)?"bg-green-800/30 text-green-100 border-green-500 hover:bg-green-700/60":"bg-gray-900 text-gray-400 border-gray-700 hover:bg-blue-900/60",m.value?"opacity-50 cursor-not-allowed":""]),onClick:u=>m.value?null:F(s,l),title:A(s,l)?L(s,l):"Click to assign staff",style:{"min-height":"48px",height:"48px",padding:"0 0.25rem",display:"flex","align-items":"center","justify-content":"center"}},[A(s,l)?(n(),r("div",pe,[t[1]||(t[1]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-green-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("span",ge,g(L(s,l)),1)])):(n(),r("div",ve,t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-400 mb-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"text-xs text-blue-300 text-center"},"Assign",-1)])))],10,ye)])),64))]))),128))])]),e("div",be,[i(v,{text:"Reset",onClick:K,class:p("text-white px-8 py-2 rounded-md font-semibold text-base"),disabled:m.value},null,8,["disabled"]),m.value?V("",!0):(n(),Q(v,{key:0,text:"Submit Weekly Schedule",onClick:E,class:p("text-white px-8 py-2 rounded-md font-semibold text-base"),disabled:m.value},null,8,["disabled"]))])])]),_:1}),i(X,{name:"fade"},{default:b(()=>[h.value!==null&&w.value!==null&&!m.value?(n(),r("div",he,[e("div",we,[e("button",{onClick:C,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-200 text-xl font-bold",disabled:d.value},"Ã—",8,_e),e("h2",ke,[S(" Assign "+g(Y[w.value])+" Shift",1),t[4]||(t[4]=e("br",null,null,-1)),e("span",Ye,"for "+g(h.value.format("ddd, MMM D")),1)]),d.value?(n(),r("div",Me,t[5]||(t[5]=[e("svg",{class:"animate-spin h-10 w-10 text-red-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),e("span",{class:"text-red-400 font-semibold text-lg"},"Validating staff...",-1)]))):(n(),r("div",De,[t[7]||(t[7]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-200"},"Select Staff",-1)),I(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),class:"border-2 border-gray-700 focus:border-red-500 focus:ring-2 focus:ring-red-200 rounded-md px-3 py-2 w-full text-base transition shadow-sm outline-none bg-gray-900 text-gray-100",disabled:d.value,autofocus:""},[t[6]||(t[6]=e("option",{value:""},"Select Staff",-1)),(n(!0),r(M,null,j(f.staffList.filter(s=>s.id!==1),s=>(n(),r("option",{key:s.id,value:s.id},g(s.name),9,Ce))),128))],8,Se),[[ee,_.value]]),i(v,{text:"Assign",onClick:P,class:p("w-full text-white font-semibold py-2 rounded-md mt-4"),disabled:d.value||!_.value},null,8,["disabled"])])),i(v,{onClick:C,text:"Cancel",class:p("w-full text-gray-200 font-semibold py-2 rounded-md transition mt-2"),disabled:d.value},null,8,["disabled"])])])):V("",!0)]),_:1})])])]),_:1})],64))}},ze=ae(Ae,[["__scopeId","data-v-6b6b0c7c"]]);export{ze as default};
