import{f as r,o as n,a as f,b as e,w as x,e as M,F as Y,Q as Z,h as N,r as h,l as z,A as B,m as q,u as J,Z as X,t as i,s as A,n as ee,G as P,g as T,d as te,y as se,z as ae,a0 as j}from"./app-x9X0OzoV.js";import{a as oe,_ as $,b as le}from"./Card-uT5VCw16.js";import{_ as re}from"./GoBackNavLink-DY91qUZX.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"space-x-8 rtl:space-x-reverse sm:flex"},de={__name:"ScheduleTabs",setup(L){return(v,m)=>(n(),r(Y,null,[f(re),e("div",ie,[f(oe,{href:v.route("schedule.admin"),active:v.route().current("schedule.admin")},{default:x(()=>[...m[0]||(m[0]=[M(" Schedule ",-1)])]),_:1},8,["href","active"])])],64))}},ce={class:"py-6"},ue={class:"max-w-5xl mx-auto sm:px-4 lg:px-6"},fe={class:"flex justify-between items-center px-2"},he={class:"font-bold text-lg text-white tracking-wide text-center"},xe={class:"px-2 pb-4 overflow-x-auto"},me={class:"w-full border-separate border-spacing-y-2"},pe={class:"py-2 px-2 align-middle"},ve={class:"w-full h-16 flex flex-col items-center justify-center rounded-xl transition-all duration-300 bg-white/5 border border-white/5 text-gray-200 group-hover:bg-white/10 group-hover:border-white/20",style:{width:"100px"}},be={class:"text-xs font-bold uppercase text-red-400"},ge={class:"text-xl font-bold"},we=["onClick","title"],ye={key:0,class:"flex items-center justify-center w-full h-full px-3"},_e={class:"text-white font-semibold text-xs text-center line-clamp-2 leading-tight break-words max-w-full"},ke={key:1,class:"flex flex-col items-center justify-center w-full h-full"},Me={class:"flex justify-end mt-8 border-t border-white/10 pt-6"},Ye=["disabled"],De={class:"bg-gradient-to-b from-gray-800 to-gray-900 rounded-2xl shadow-2xl w-full max-w-sm relative animate-fadeIn border border-white/10 overflow-hidden"},Ce={class:"px-6 pt-6 pb-4 border-b border-white/5 bg-white/[0.02]"},Se=["disabled"],Ae={class:"flex items-center gap-3 mb-1"},je={class:"text-lg font-bold text-white"},Le={class:"text-xs text-gray-400"},Ve={class:"p-6"},Ne={key:0,class:"flex flex-col items-center justify-center py-8"},ze={key:1},Be={class:"relative"},Pe=["disabled"],Te=["value"],$e={class:"px-6 pb-6 flex gap-3"},Fe=["disabled"],Re=["disabled"],Ee={key:0,class:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60]"},We={class:"bg-gray-900 rounded-2xl shadow-2xl w-full max-w-md border border-red-500/30 overflow-hidden animate-fadeIn"},He={class:"p-6 text-center"},Ie={class:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 mb-6"},Oe={class:"text-gray-300 text-sm mb-1"},Ue={class:"text-white font-bold"},Ge={class:"text-xs text-red-400 font-mono mt-2"},Ke={__name:"AdminSchedule",props:{staffList:{type:Array,default:()=>[]},leaveList:{type:Array,default:()=>[]}},setup(L){const v=Z(),m=N(()=>{var s;return(s=v.props.flash)==null?void 0:s.reassign_alert}),C=h(!1);z(()=>{var s;return(s=v.props.flash)==null?void 0:s.reassign_alert},s=>{s&&(C.value=!0)},{immediate:!0});function F(){C.value=!1}const b=L;console.log("staffList:",b.staffList);const R=["Morning","Night"],E=["morning","evening"],W=B().startOf("week").add(1,"day"),d=h(W),g=h(null),w=h(null),c=h(!1),u=h({}),y=h(""),_=h(!1);async function p(){const s=d.value.format("YYYY-MM-DD"),{data:t}=await j.get("/schedule/week",{params:{week_start:s}});u.value=t.assignments||{},_.value=t.submitted||!1}q(p),z(d,p);const H=N(()=>Array.from({length:7},(s,t)=>d.value.add(t,"day")));function I(s,t){g.value=s,w.value=t,u.value[s.format("YYYY-MM-DD")]||(u.value[s.format("YYYY-MM-DD")]=[null,null]),y.value=u.value[s.format("YYYY-MM-DD")][t]||""}function D(){c.value||(g.value=null,w.value=null)}async function O(){c.value=!0;const s=y.value,t=g.value.format("YYYY-MM-DD"),a=d.value.format("YYYY-MM-DD");if(b.leaveList&&b.leaveList.some(o=>o.user_id==s&&o.start_date<=t&&(!o.end_date||o.end_date>=t))){c.value=!1,alert("This staff is on leave for the selected day. Please pick another staff.");return}if((u.value[t]||[null,null]).includes(s)){c.value=!1,alert("This staff is already assigned to another shift on this day. Please pick another staff.");return}let l=0;for(const[o,Q]of Object.entries(u.value))o>=a&&o<=B(a).add(6,"day").format("YYYY-MM-DD")&&Q.includes(s)&&l++;if(l>=6){c.value=!1,alert("This staff is already assigned to 6 days in this week. Please pick another staff.");return}try{await j.post("/schedule/assign",{employee_id:s,shift_type:E[w.value],day:t}),await p(),D()}catch(o){o.response&&o.response.status===422?alert(o.response.data.error||"Validation failed"):alert("An error occurred while assigning staff.")}finally{c.value=!1}}function U(){d.value=d.value.subtract(1,"week"),p()}function G(){d.value=d.value.add(1,"week"),p()}function V(s,t){var l;const a=(l=u.value[s.format("YYYY-MM-DD")])==null?void 0:l[t],k=b.staffList.find(o=>o.id==a);return k?k.name:""}function S(s,t){var a;return!!((a=u.value[s.format("YYYY-MM-DD")])!=null&&a[t])}async function K(){confirm("Are you sure you want to reset all assignments for this week?")&&(await j.post("/schedule/reset",{week_start:d.value.format("YYYY-MM-DD")}),u.value={},await p())}return(s,t)=>(n(),r(Y,null,[f(J(X),{title:"Weekly Schedule"}),f(le,null,{tabs:x(()=>[f(de)]),default:x(()=>[e("div",ce,[e("div",ue,[f($,{variant:"glass",class:"!mt-0"},{default:x(()=>[e("div",fe,[e("button",{onClick:U,class:"bg-white/5 border border-white/10 hover:bg-white/10 text-white px-6 py-2 rounded-full font-bold text-sm transition-all shadow-none"},i(s.__("Previous")),1),e("span",he,i(d.value.format("MMM D, YYYY"))+" - "+i(d.value.add(6,"day").format("MMM D, YYYY")),1),e("button",{onClick:G,class:"bg-white/5 border border-white/10 hover:bg-white/10 text-white px-6 py-2 rounded-full font-bold text-sm transition-all shadow-none"},i(s.__("Next")),1)])]),_:1}),f($,{variant:"glass",class:"mt-6"},{default:x(()=>[t[3]||(t[3]=e("div",{class:"mb-4 px-2"},[e("div",{class:"flex items-center gap-3 bg-gradient-to-r from-amber-500/10 to-orange-500/5 border border-amber-500/20 rounded-xl px-4 py-3"},[e("div",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-amber-500/20 flex-shrink-0"},[e("svg",{class:"w-4 h-4 text-amber-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})])]),e("div",{class:"text-sm"},[e("span",{class:"text-amber-300 font-medium"},"Your Schedule:"),e("span",{class:"text-gray-300 ml-1"},"Mon – Fri, 9:00 AM – 5:00 PM"),e("span",{class:"text-gray-500 ml-1"},"• Excluded from shift assignments")])])],-1)),e("div",xe,[e("table",me,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 px-4 text-left"}," Day "),e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 text-center"},[M(" Morning"),e("br"),e("span",{class:"text-[10px] text-gray-500"},"6:00 AM - 3:00 PM")]),e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 text-center"},[M(" Night"),e("br"),e("span",{class:"text-[10px] text-gray-500"},"3:00 PM - 12:00 AM")])])],-1)),e("tbody",null,[(n(!0),r(Y,null,A(H.value,(a,k)=>(n(),r("tr",{key:k,class:"group"},[e("td",pe,[e("div",ve,[e("span",be,i(a.format("ddd")),1),e("span",ge,i(a.format("D")),1)])]),(n(),r(Y,null,A([0,1],l=>e("td",{key:l,class:"py-2 px-2 align-middle"},[e("div",{class:ee(["min-w-[180px] h-16 flex items-center justify-center rounded-xl transition-all duration-300 border cursor-pointer relative backdrop-blur-md",S(a,l)?"bg-gradient-to-br from-green-500/20 to-emerald-900/40 border-green-500/30 hover:border-green-400/50 hover:shadow-lg hover:shadow-green-900/20":"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20 text-gray-400",_.value?"opacity-50 cursor-not-allowed grayscale":""]),onClick:o=>_.value?null:I(a,l),title:S(a,l)?V(a,l):"Click to assign staff"},[S(a,l)?(n(),r("div",ye,[e("span",_e,i(V(a,l)),1)])):(n(),r("div",ke,[...t[1]||(t[1]=[e("span",{class:"text-2xl text-white/20 font-light mb-0 leading-none"},"+",-1),e("span",{class:"text-[10px] uppercase tracking-wider text-white/40 font-bold"},"Assign",-1)])]))],10,we)])),64))]))),128))])]),e("div",Me,[e("button",{onClick:K,disabled:_.value,class:"px-6 py-2 rounded-full font-bold text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-all disabled:opacity-50"}," Reset Week ",8,Ye)])])]),_:1}),f(P,{name:"fade"},{default:x(()=>[g.value!==null&&w.value!==null&&!_.value?(n(),r("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",onClick:te(D,["self"])},[e("div",De,[e("div",Ce,[e("button",{onClick:D,class:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-full bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white transition-all",disabled:c.value},[...t[4]||(t[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Se),e("div",Ae,[t[5]||(t[5]=e("div",{class:"w-10 h-10 rounded-xl bg-red-500/10 flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",null,[e("h2",je,i(R[w.value])+" Shift ",1),e("p",Le,i(g.value.format("dddd, MMMM D, YYYY")),1)])])]),e("div",Ve,[c.value?(n(),r("div",Ne,[...t[6]||(t[6]=[e("svg",{class:"animate-spin h-8 w-8 text-red-500 mb-3",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),e("span",{class:"text-gray-400 font-medium text-sm"},"Validating...",-1)])])):(n(),r("div",ze,[t[9]||(t[9]=e("label",{class:"block text-xs font-bold uppercase tracking-wider text-gray-400 mb-2"}," Select Staff Member ",-1)),e("div",Be,[se(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),class:"w-full bg-white/5 border border-white/10 text-gray-100 text-sm rounded-xl focus:ring-red-500 focus:border-red-500 block p-3 pr-10 appearance-none transition-all",disabled:c.value,autofocus:""},[t[7]||(t[7]=e("option",{value:"",class:"bg-gray-900"}," Choose staff... ",-1)),(n(!0),r(Y,null,A(b.staffList,a=>(n(),r("option",{key:a.id,value:a.id,class:"bg-gray-900"},i(a.name),9,Te))),128))],8,Pe),[[ae,y.value]]),t[8]||(t[8]=e("div",{class:"absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]))]),e("div",$e,[e("button",{onClick:D,disabled:c.value,class:"flex-1 px-4 py-3 rounded-xl font-semibold text-sm text-gray-300 bg-white/5 border border-white/10 hover:bg-white/10 hover:text-white transition-all disabled:opacity-50"}," Cancel ",8,Fe),e("button",{onClick:O,disabled:c.value||!y.value,class:"flex-1 px-4 py-3 rounded-xl font-bold text-sm text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 shadow-lg shadow-red-900/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed"}," Assign Staff ",8,Re)])])])):T("",!0)]),_:1}),f(P,{name:"fade"},{default:x(()=>[C.value&&m.value?(n(),r("div",Ee,[e("div",We,[e("div",He,[t[12]||(t[12]=e("div",{class:"w-16 h-16 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-4 animate-bounce"},[e("svg",{class:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t[13]||(t[13]=e("h3",{class:"text-xl font-bold text-white mb-2"}," Schedule Conflict Resolved ",-1)),e("div",Ie,[e("p",Oe,[t[10]||(t[10]=M(" Emergency Leave for ",-1)),e("span",Ue,i(m.value.name),1),t[11]||(t[11]=M(" was approved. ",-1))]),e("p",Ge," CLEARED SHIFTS: "+i(m.value.dates),1)]),t[14]||(t[14]=e("p",{class:"text-gray-400 text-sm mb-6"}," The conflicting shifts have been removed. Please check the schedule and reassign these slots if necessary. ",-1)),e("button",{onClick:F,class:"w-full px-4 py-3 rounded-xl font-bold text-sm text-white bg-red-600 hover:bg-red-700 shadow-lg shadow-red-900/30 transition-all"}," Understood, I'll Reassign ")])])])):T("",!0)]),_:1})])])]),_:1})],64))}},et=ne(Ke,[["__scopeId","data-v-091fc60b"]]);export{et as default};
