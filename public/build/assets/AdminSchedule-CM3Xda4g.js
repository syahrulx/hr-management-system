import{f as o,o as n,a as c,b as e,w as x,e as M,F as _,B as L,r as v,p as U,m as Z,h as q,u as G,Z as J,t as u,y as C,n as A,g as $,H as Q,i as X,A as I,a1 as Y}from"./app-Dy-6RBJ3.js";import{a as ee,_ as V}from"./Card-CTpZneKR.js";import{_ as te,a as se}from"./NavLink-BXQnaibR.js";import{_ as T}from"./FlexButton-CySXVB9h.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"space-x-8 rtl:space-x-reverse sm:flex"},oe={__name:"ScheduleTabs",setup(j){return(m,k)=>(n(),o(_,null,[c(ee),e("div",le,[c(te,{href:m.route("schedule.admin"),active:m.route().current("schedule.admin")},{default:x(()=>[...k[0]||(k[0]=[M(" Schedule ",-1)])]),_:1},8,["href","active"])])],64))}},ne={class:"py-6"},re={class:"max-w-5xl mx-auto sm:px-4 lg:px-6"},ie={class:"flex justify-between items-center px-2"},de={class:"font-bold text-lg text-white tracking-wide text-center"},ue={class:"px-2 pb-4 overflow-x-auto"},ce={class:"w-full border-separate border-spacing-y-2"},fe={class:"py-2 px-2 align-middle"},me={class:"w-full h-16 flex flex-col items-center justify-center rounded-xl transition-all duration-300 bg-white/5 border border-white/5 text-gray-200 group-hover:bg-white/10 group-hover:border-white/20",style:{width:"100px"}},he={class:"text-xs font-bold uppercase text-red-400"},pe={class:"text-xl font-bold"},ve=["onClick","title"],xe={key:0,class:"flex flex-col items-center justify-center w-full px-2"},be={class:"text-white font-semibold text-xs text-center line-clamp-2 leading-tight"},ge={key:1,class:"flex flex-col items-center justify-center w-full group-hover:scale-110 transition-transform duration-300"},ye={class:"flex justify-end mt-8 space-x-4 border-t border-white/10 pt-6"},we=["disabled"],_e=["disabled"],ke={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Ye={class:"bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md relative animate-fadeIn border border-gray-700"},Me=["disabled"],De={class:"text-2xl font-bold mb-6 text-gray-100 text-center"},Se={class:"text-base font-medium text-gray-400"},Ce={key:0,class:"flex flex-col items-center justify-center py-8"},Ae={key:1,class:"mb-6"},je=["disabled"],Ne=["value"],Le={__name:"AdminSchedule",props:{staffList:{type:Array,default:()=>[]},leaveList:{type:Array,default:()=>[]}},setup(j){const m=j;console.log("staffList:",m.staffList);const k=["Morning","Night"],B=["morning","evening"],W=L().startOf("week").add(1,"day"),r=v(W),b=v(null),g=v(null),i=v(!1),f=v({}),y=v(""),h=v(!1);async function p(){const a=r.value.format("YYYY-MM-DD"),{data:t}=await Y.get("/schedule/week",{params:{week_start:a}});f.value=t.assignments||{},h.value=t.submitted||!1}U(p),Z(r,p);const F=q(()=>Array.from({length:7},(a,t)=>r.value.add(t,"day")));function P(a,t){b.value=a,g.value=t,f.value[a.format("YYYY-MM-DD")]||(f.value[a.format("YYYY-MM-DD")]=[null,null]),y.value=f.value[a.format("YYYY-MM-DD")][t]||""}function D(){i.value||(b.value=null,g.value=null)}async function z(){i.value=!0;const a=y.value,t=b.value.format("YYYY-MM-DD"),s=r.value.format("YYYY-MM-DD");if(m.leaveList&&m.leaveList.some(d=>d.user_id==a&&d.start_date<=t&&(!d.end_date||d.end_date>=t))){i.value=!1,alert("This staff is on leave for the selected day. Please pick another staff.");return}if((f.value[t]||[null,null]).includes(a)){i.value=!1,alert("This staff is already assigned to another shift on this day. Please pick another staff.");return}let l=0;for(const[d,R]of Object.entries(f.value))d>=s&&d<=L(s).add(6,"day").format("YYYY-MM-DD")&&R.includes(a)&&l++;if(l>=6){i.value=!1,alert("This staff is already assigned to 6 days in this week. Please pick another staff.");return}await Y.post("/schedule/assign",{employee_id:a,shift_type:B[g.value],day:t}),await p(),i.value=!1,D()}function H(){r.value=r.value.subtract(1,"week"),p()}function O(){r.value=r.value.add(1,"week"),p()}async function E(){await Y.post("/schedule/submit-week",{week_start:r.value.format("YYYY-MM-DD")}),await p(),alert("Weekly schedule submitted successfully!")}function N(a,t){var l;const s=(l=f.value[a.format("YYYY-MM-DD")])==null?void 0:l[t],w=m.staffList.find(d=>d.id==s);return w?w.name:""}function S(a,t){var s;return!!((s=f.value[a.format("YYYY-MM-DD")])!=null&&s[t])}async function K(){confirm("Are you sure you want to reset all assignments for this week?")&&(await Y.post("/schedule/reset",{week_start:r.value.format("YYYY-MM-DD")}),f.value={},await p())}return(a,t)=>(n(),o(_,null,[c(G(J),{title:"Weekly Schedule"}),c(se,null,{tabs:x(()=>[c(oe)]),default:x(()=>[e("div",ne,[e("div",re,[c(V,{variant:"glass",class:"!mt-0"},{default:x(()=>[e("div",ie,[e("button",{onClick:H,class:"bg-white/5 border border-white/10 hover:bg-white/10 text-white px-6 py-2 rounded-full font-bold text-sm transition-all shadow-none"},u(a.__("Previous")),1),e("span",de,u(r.value.format("MMM D, YYYY"))+" - "+u(r.value.add(6,"day").format("MMM D, YYYY")),1),e("button",{onClick:O,class:"bg-white/5 border border-white/10 hover:bg-white/10 text-white px-6 py-2 rounded-full font-bold text-sm transition-all shadow-none"},u(a.__("Next")),1)])]),_:1}),c(V,{variant:"glass",class:"mt-6"},{default:x(()=>[e("div",ue,[e("table",ce,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 px-4 text-left"}," Day "),e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 text-center"},[M(" Morning"),e("br"),e("span",{class:"text-[10px] text-gray-500"},"6:00 - 15:00")]),e("th",{class:"text-xs font-bold text-gray-400 uppercase tracking-widest py-4 text-center"},[M(" Night"),e("br"),e("span",{class:"text-[10px] text-gray-500"},"15:00 - 00:00")])])],-1)),e("tbody",null,[(n(!0),o(_,null,C(F.value,(s,w)=>(n(),o("tr",{key:w,class:"group"},[e("td",fe,[e("div",me,[e("span",he,u(s.format("ddd")),1),e("span",pe,u(s.format("D")),1)])]),(n(),o(_,null,C([0,1],l=>e("td",{key:l,class:"py-2 px-2 align-middle"},[e("div",{class:A(["w-full h-16 flex items-center justify-center rounded-xl transition-all duration-300 border cursor-pointer relative backdrop-blur-md",S(s,l)?"bg-gradient-to-br from-green-500/20 to-emerald-900/40 border-green-500/30 hover:border-green-400/50 hover:shadow-lg hover:shadow-green-900/20":"bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20 text-gray-400",h.value?"opacity-50 cursor-not-allowed grayscale":""]),onClick:d=>h.value?null:P(s,l),title:S(s,l)?N(s,l):"Click to assign staff"},[S(s,l)?(n(),o("div",xe,[e("span",be,u(N(s,l)),1)])):(n(),o("div",ge,[...t[1]||(t[1]=[e("span",{class:"text-2xl text-white/20 font-light mb-0 leading-none"},"+",-1),e("span",{class:"text-[10px] uppercase tracking-wider text-white/40 font-bold"},"Assign",-1)])]))],10,ve)])),64))]))),128))])]),e("div",ye,[e("button",{onClick:K,disabled:h.value,class:"px-6 py-2 rounded-full font-bold text-sm text-gray-400 hover:text-white hover:bg-white/5 transition-all disabled:opacity-50"}," Reset Week ",8,we),h.value?$("",!0):(n(),o("button",{key:0,onClick:E,disabled:h.value,class:"px-8 py-3 rounded-full font-bold text-sm text-white uppercase tracking-wider bg-gradient-to-r from-red-600 to-red-800 shadow-lg shadow-red-900/40 hover:shadow-red-600/40 hover:scale-105 active:scale-95 transition-all duration-300"}," Submit Schedule ",8,_e))])])]),_:1}),c(Q,{name:"fade"},{default:x(()=>[b.value!==null&&g.value!==null&&!h.value?(n(),o("div",ke,[e("div",Ye,[e("button",{onClick:D,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-200 text-xl font-bold",disabled:i.value}," Ã— ",8,Me),e("h2",De,[M(" Assign "+u(k[g.value])+" Shift",1),t[3]||(t[3]=e("br",null,null,-1)),e("span",Se,"for "+u(b.value.format("ddd, MMM D")),1)]),i.value?(n(),o("div",Ce,[...t[4]||(t[4]=[e("svg",{class:"animate-spin h-10 w-10 text-red-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),e("span",{class:"text-red-400 font-semibold text-lg"},"Validating staff...",-1)])])):(n(),o("div",Ae,[t[6]||(t[6]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-200"},"Select Staff",-1)),X(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),class:"border-2 border-gray-700 focus:border-red-500 focus:ring-2 focus:ring-red-200 rounded-md px-3 py-2 w-full text-base transition shadow-sm outline-none bg-gray-900 text-gray-100",disabled:i.value,autofocus:""},[t[5]||(t[5]=e("option",{value:""},"Select Staff",-1)),(n(!0),o(_,null,C(m.staffList.filter(s=>s.id!==1),s=>(n(),o("option",{key:s.id,value:s.id},u(s.name),9,Ne))),128))],8,je),[[I,y.value]]),c(T,{text:"Assign",onClick:z,class:A("w-full text-white font-semibold py-2 rounded-md mt-4"),disabled:i.value||!y.value},null,8,["disabled"])])),c(T,{onClick:D,text:"Cancel",class:A("w-full text-gray-200 font-semibold py-2 rounded-md transition mt-2"),disabled:i.value},null,8,["disabled"])])])):$("",!0)]),_:1})])])]),_:1})],64))}},Pe=ae(Le,[["__scopeId","data-v-b7212f96"]]);export{Pe as default};
